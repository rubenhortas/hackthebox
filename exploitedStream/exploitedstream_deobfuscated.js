// Script to solve the misc challenge "ExploitedStream" from https://app.hackthebox.com
// You can read the full walkthrough here: https://rubenhortas.github.io/posts/htb-exploitedstream

try {
  var crypto = require('crypto'), algorithm = 'aes-256-ctr';

  function decrypt(ct, alg, k) {
    var decipher = crypto.createDecipher(alg, k)
    var pt = decipher.update(ct, 'hex', 'utf8')

    pt += decipher.final('utf8');

    return pt;
  }

  // let for_future_me = 'cGFzc3dvcmRfaXNfdGhlX25hbWVfb2Zfb25lX25wbV9wYWNrYWdl'; // 'password_is_the_name_of_one_npm_package'
  let noxc = '83729c4575f56a8287c0b4e8ee5c33f8cb891ccaddcafb71ef5f7bd067f19d854ab16e0cb22460';

  // bruteforce with https://github.com/nice-registry/all-the-package-names/blob/master/names.json
  const fs = require('fs');
  let packageNames = JSON.parse(fs.readFileSync("./names.json", "utf8"))

  for (let i = 0; i< packageNames.length; i++) {
    let pt = decrypt(noxc, algorithm, packageNames[i]);

    if(pt.substring(0,3) == 'HTB') {
      console.log(packageNames[i]);
      console.log(pt);
    }
  }
} catch (e) {
  console.log(e);
}
